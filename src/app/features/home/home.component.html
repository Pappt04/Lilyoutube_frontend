<div class="home-container">
    @if (isLoggedIn$ | async) {
    <!-- Popular Videos Section (Only for logged-in users) -->
    <section class="popular-videos-section">
        <h2>ðŸ”¥ Popular Videos</h2>
        <div class="popular-video-grid">
            @if (popularVideos$ | async; as popularVideos) {
                @if (popularVideos.length > 0) {
                    @for (popularVideo of popularVideos; track popularVideo.id) {
                    <div class="popular-video-card" (click)="navigateToVideo(popularVideo.post.videoPath)">
                        <div class="rank-badge">TOP {{ popularVideo.rank }}</div>
                        <div class="thumbnail">
                            <img [src]="getThumbnailUrl(popularVideo.post.thumbnailPath) | secureMedia | async"
                                 alt="{{ popularVideo.post.title }}">
                        </div>
                        <div class="video-info">
                            <div class="video-avatar"></div>
                            <div class="text-info">
                                <h3 class="video-title">{{ popularVideo.post.title }}</h3>
                                <p class="video-meta">
                                    <a [routerLink]="['/users', popularVideo.post.user_id]"
                                       (click)="$event.stopPropagation()"
                                       class="user-link">
                                        User #{{ popularVideo.post.user_id }}
                                    </a>
                                    â€¢ {{ popularVideo.post.location || 'Unknown' }}
                                </p>
                            </div>
                        </div>
                    </div>
                    }
                } @else {
                    <p class="no-data">No popular videos available yet. ETL pipeline will run daily at midnight.</p>
                }
            } @else {
                <p>Loading popular videos...</p>
            }
        </div>
    </section>
    }

    <h1>Recommended Videos</h1>
    <div class="video-grid">
        @if (videos$ | async; as videos) {
        @for (video of videos; track video.videoPath) {
        <div class="video-card" (click)="navigateToVideo(video.videoPath)">
            <div class="thumbnail">
                <img [src]="getThumbnailUrl(video.thumbnailPath) | secureMedia | async" alt="{{ video.title }}">
            </div>
            <div class="video-info">
                <div class="video-avatar"></div>
                <div class="text-info">
                    <h3 class="video-title">{{ video.title }}</h3>
                    <p class="video-meta">
                        <a [routerLink]="['/users', video.user_id]" (click)="$event.stopPropagation()" class="user-link">
                            User #{{ video.user_id }}
                        </a>
                        â€¢ {{ video.location || 'Unknown' }}
                    </p>
                </div>
            </div>
        </div>
        }
        } @else {
        <p>Loading videos...</p>
        }
    </div>
</div>