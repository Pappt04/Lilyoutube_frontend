<div class="home-container">
    <h1>Recommended Videos</h1>

    @if (isLoggedIn && (popularVideos$ | async); as popularVideos) {
    @if (popularVideos.length > 0) {
    <div class="popular-section">
        <h2>Trending Now ðŸ”¥</h2>
        <div class="video-grid popular-grid">
            @for (item of popularVideos; track item.id) {
            <div class="video-card popular-card" (click)="navigateToVideo(item.video.videoPath)">
                <div class="thumbnail">
                    <img [src]="getThumbnailUrl(item.video.thumbnailPath) | secureMedia | async"
                        alt="{{ item.video.title }}">
                    <div class="rank-badge">#{{ $index + 1 }}</div>
                </div>
                <div class="video-info">
                    <div class="text-info">
                        <h3 class="video-title">{{ item.video.title }}</h3>
                        <p class="video-meta">
                            <span class="score">Score: {{ item.popularityScore | number:'1.0-0' }}</span>
                        </p>
                    </div>
                </div>
            </div>
            }
        </div>
    </div>
    }
    }

    <h2>Recent Uploads</h2>
    <div class="video-grid">
        @if (videos$ | async; as videos) {
        @for (video of videos; track video.videoPath) {
        <div class="video-card" (click)="navigateToVideo(video.videoPath)">
            <div class="thumbnail">
                <img [src]="getThumbnailUrl(video.thumbnailPath) | secureMedia | async" alt="{{ video.title }}">
            </div>
            <div class="video-info">
                <div class="video-avatar"></div>
                <div class="text-info">
                    <h3 class="video-title">{{ video.title }}</h3>
                    <p class="video-meta">
                        <a [routerLink]="['/users', video.user_id]" (click)="$event.stopPropagation()"
                            class="user-link">
                            User #{{ video.user_id }}
                        </a>
                        â€¢ {{ video.location || 'Unknown' }}
                    </p>
                </div>
            </div>
        </div>
        }
        } @else {
        <p>Loading videos...</p>
        }
    </div>
</div>